<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz: Anwendung in der Schule - Urheberrecht</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: rgba(255,255,255,0.95);
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .canton-logo {
            width: 40px;
            height: 40px;
            background: #0050a0;
            color: white;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        h1 {
            font-size: 24px;
            color: #0050a0;
        }
        
        /* NEU: Navigation Bar */
        .nav-bar {
            background: #f5f5f5;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }

        .nav-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #0050a0;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .nav-link:hover {
            background: rgba(0, 80, 160, 0.1);
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #666;
            font-size: 14px;
        }

        .breadcrumb a {
            color: #0050a0;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        /* Main Container */
        .main {
            max-width: 900px;
            margin: 40px auto;
            padding: 0 20px;
        }

        /* Quiz Card */
        .quiz-card {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .quiz-title {
            color: #0050a0;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .quiz-subtitle {
            color: #666;
            font-size: 18px;
        }

        /* Progress Bar */
        .progress-container {
            background: #e5e5e5;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #0050a0, #0066cc);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Question Types */
        .question-container {
            margin-bottom: 30px;
            min-height: 400px;
        }

        .question-header {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .question-type {
            display: inline-block;
            background: #0050a0;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .question-text {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        /* Swipe Cards */
        .swipe-container {
            position: relative;
            height: 400px;
            margin: 30px auto;
            max-width: 500px;
        }

        .swipe-card {
            position: absolute;
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            padding: 30px;
            cursor: grab;
            transition: transform 0.3s, opacity 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .swipe-card.dragging {
            cursor: grabbing;
        }

        .swipe-hint {
            display: flex;
            justify-content: space-between;
            padding: 0 50px;
            margin-bottom: 20px;
        }

        .swipe-left, .swipe-right {
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
        }

        .swipe-left {
            background: #ffebee;
            color: #c62828;
        }

        .swipe-right {
            background: #e8f5e9;
            color: #2e7d32;
        }

        /* Drag & Drop */
        .drag-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }

        .drag-items {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
        }

        .drag-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: move;
            transition: all 0.3s;
            border: 2px solid #ddd;
        }

        .drag-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .drag-item.dragging {
            opacity: 0.5;
        }

        .drop-zones {
            display: grid;
            gap: 15px;
        }

        .drop-zone {
            background: white;
            border: 2px dashed #0050a0;
            padding: 20px;
            border-radius: 10px;
            min-height: 80px;
            transition: all 0.3s;
        }

        .drop-zone.drag-over {
            background: #e8f2ff;
            border-color: #0066cc;
        }

        .drop-zone-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #0050a0;
        }

        /* Slider Question */
        .slider-container {
            margin: 30px 0;
        }

        .slider-scenario {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .slider-wrapper {
            margin: 20px 0;
        }

        .slider {
            width: 100%;
            height: 40px;
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
        }

        .slider::-webkit-slider-track {
            width: 100%;
            height: 10px;
            background: linear-gradient(to right, #f44336 0%, #ffc107 50%, #4caf50 100%);
            border-radius: 5px;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 30px;
            background: white;
            border: 3px solid #0050a0;
            border-radius: 50%;
            cursor: pointer;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
        }

        .slider-value {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
            color: #0050a0;
        }

        /* Chat Simulation */
        .chat-container {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .chat-message {
            margin: 10px 0;
            display: flex;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .chat-message.user {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 15px;
            background: white;
        }

        .user .message-bubble {
            background: #0050a0;
            color: white;
        }

        .chat-options {
            display: grid;
            gap: 10px;
        }

        .chat-option {
            padding: 12px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .chat-option:hover {
            background: #e8f2ff;
            border-color: #0050a0;
        }

        /* Timeline Question */
        .timeline-slot .slot-content {
            font-size: 14px;
            padding: 5px;
            text-align: center;
        }

        /* Navigation */
        .quiz-navigation {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }

        .nav-button {
            padding: 12px 24px;
            background: #0050a0;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none; /* Für a-Tags */
        }

        .nav-button:hover:not(:disabled) {
            background: #003d7a;
            transform: translateY(-1px);
        }

        .nav-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Score Display */
        .score-display {
            padding: 8px 16px;
            background: #f5f5f5;
            border-radius: 10px;
            font-weight: 500;
        }

        .score-number {
            font-size: 48px;
            font-weight: bold;
            color: #0050a0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .quiz-card {
                padding: 20px;
            }

            .drag-container {
                grid-template-columns: 1fr;
            }

            .swipe-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="canton-logo">ZH</div>
                <h1>Anwendung in der Schule</h1>
            </div>
            <div class="score-display">
                <span id="currentScore">0</span> / <span id="totalPoints">8</span> Punkte
            </div>
        </div>
    </header>
    
    <nav class="nav-bar">
        <div class="nav-content">
            <a href="../index.html" class="nav-link">
                <span>←</span>
                <span>Zurück zur Übersicht</span>
            </a>
            <div class="breadcrumb">
                <a href="../index.html">Startseite</a>
                <span>›</span>
                <span>Wissenstest</span>
                <span>›</span>
                <span>Anwendung Schule</span>
            </div>
        </div>
    </nav>

    <main class="main">
        <div class="quiz-card">
            <div class="quiz-header">
                <h2 class="quiz-title">🚀 Interaktives Praxis-Quiz</h2>
                <p class="quiz-subtitle">Swipe, drag & drop, entscheide - teste dein Wissen spielerisch!</p>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progressBar" style="width: 0%">
                    <span>1 / 8</span>
                </div>
            </div>

            <div class="question-container" id="questionContainer">
                </div>

            <div class="quiz-navigation">
                <button class="nav-button" id="checkBtn" style="display:none;">
                    <span>✓</span>
                    <span>Prüfen</span>
                </button>
                <button class="nav-button" id="nextBtn" onclick="nextQuestion()" disabled>
                    <span>Weiter</span>
                    <span>→</span>
                </button>
            </div>
        </div>
    </main>

    <script>
        // Quiz Questions - 8 questions, 1 point each.
        const questions = [
            {
                type: 'swipe',
                title: 'Swipe-Entscheidung: Erlaubt oder Verboten?',
                intro: 'Swipe nach rechts für ERLAUBT ✅, nach links für VERBOTEN ❌',
                cards: [
                    { text: 'Frau Müller scannt das komplette Deutschbuch und lädt es auf Teams hoch.', correct: false },
                    { text: 'Herr Weber zeigt ein YouTube-Video im Unterricht über Beamer.', correct: true },
                    { text: 'Sarah postet Klassenfotos ohne zu fragen auf Instagram.', correct: false },
                    { text: 'Der Sportlehrer spielt seine private Spotify-Playlist während des Trainings.', correct: true }
                ]
            },
            {
                type: 'drag',
                title: 'Drag & Drop: Ordne die Materialien zu!',
                intro: 'Ziehe die Materialien zur passenden Nutzungs-Kategorie.',
                items: ['Wikipedia-Artikel', 'Netflix-Film', 'Pixabay-Foto', 'NZZ-Artikel', 'CC0-Grafik', 'Schulbuch-Ausschnitt'],
                zones: [
                    { id: 'free', title: '✅ Frei nutzbar (oft mit Quelle)', correct: ['Pixabay-Foto', 'CC0-Grafik', 'Wikipedia-Artikel'] },
                    { id: 'education', title: '📚 Nur für Bildung im Unterricht', correct: ['NZZ-Artikel', 'Schulbuch-Ausschnitt'] },
                    { id: 'restricted', title: '🔒 Stark eingeschränkt/privat', correct: ['Netflix-Film'] }
                ]
            },
            {
                type: 'slider',
                title: 'Risiko-Barometer',
                intro: 'Bewerte das rechtliche Risiko von 0 (sicher) bis 100 (gefährlich).',
                scenarios: [
                    { text: 'Du verwendest ein Bild von Unsplash (freie Lizenz) für deine Präsentation.', correctRange: [0, 20] },
                    { text: 'Du kopierst einen Zeitungsartikel und teilst ihn öffentlich auf der Schulwebsite.', correctRange: [80, 100] },
                    { text: 'Du teilst einen Meme im privaten Klassen-Chat.', correctRange: [20, 50] }
                ]
            },
            {
                type: 'chat',
                title: 'Chat-Simulation: Beratung',
                intro: 'Ein Schüler fragt dich um Rat. Wähle die beste Antwort!',
                conversation: [{ from: 'student', text: 'Hey! Ich mache ein Video für Geschichte und will den Soundtrack von "Star Wars" verwenden. Geht das?' }],
                options: [
                    { text: 'Klar, für Schulprojekte ist alles erlaubt!', correct: false, feedback: 'Falsch! Auch für die Schule gibt es Regeln, besonders bei Musik und Filmen.' },
                    { text: 'Nein, das ist riskant. Nimm lieber lizenzfreie Musik, z.B. aus der YouTube Audio Library.', correct: true, feedback: 'Richtig! Das ist die sicherste und beste Vorgehensweise.' },
                    { text: 'Ja, aber nur, wenn das Video nicht länger als 30 Sekunden ist.', correct: false, feedback: 'Falsch! Die "30-Sekunden-Regel" ist ein Mythos und rechtlich nicht haltbar.' }
                ]
            },
            {
                type: 'timeline',
                title: 'Timeline: Der richtige Ablauf',
                intro: 'Ordne die Schritte zur korrekten Nutzung fremder Inhalte in der richtigen Reihenfolge an.',
                events: ['Lizenz prüfen', 'Material nutzen', 'Quelle korrekt angeben', 'Material finden'],
                correctOrder: ['Material finden', 'Lizenz prüfen', 'Material nutzen', 'Quelle korrekt angeben']
            },
            {
                type: 'scenario',
                title: 'Entscheidungsbaum: Meme im Unterricht',
                intro: 'Navigiere durch die Situation, um die richtige Entscheidung zu treffen.',
                scenario: 'Du willst ein bekanntes Meme für dein Referat verwenden.',
                decisions: [
                    {
                        question: 'Woher stammt das Bild im Meme?',
                        options: [
                            { text: 'Aus einem aktuellen Kinofilm (geschützt)', next: 1 },
                            { text: 'Von einer freien Plattform wie Pixabay (lizenzfrei)', result: 'success', feedback: 'Perfekt! Wenn die Bildquelle frei ist, bist du auf der sicheren Seite.' }
                        ]
                    },
                    {
                        question: 'Wie willst du das Referat verbreiten?',
                        options: [
                            { text: 'Nur im Klassenzimmer zeigen.', result: 'ok', feedback: 'Das ist im Rahmen des Klassenverbands meist unproblematisch (Trotzdem rechtliche Grauzone).' },
                            { text: 'Auf der Schulwebsite für alle veröffentlichen.', result: 'danger', feedback: 'Gefährlich! Eine öffentliche Verbreitung von geschütztem Material ist eine Urheberrechtsverletzung.' }
                        ]
                    }
                ]
            },
            {
                type: 'matching',
                title: 'Verbinde die Paare',
                intro: 'Welche Aussage passt zu welcher Regel?',
                pairs: [
                    { left: 'CC BY', right: 'Namensnennung ist Pflicht' },
                    { left: 'Gemeinfreiheit (Public Domain)', right: 'Nach 70 Jahren Schutzfrist' },
                    { left: 'Copyright ©', right: 'Alle Rechte vorbehalten' },
                    { left: 'Zitat', right: 'Kurzer Ausschnitt mit Quellenangabe' }
                ]
            },
            {
                type: 'quickfire',
                title: '⚡ Quickfire Round!',
                intro: '10 Sekunden pro Frage – wie viele schaffst du?',
                questions: [
                    { q: 'Ist die "30-Sekunden-Regel" für Musik rechtlich gültig?', a: ['Ja', 'Nein', 'Manchmal'], correct: 1 },
                    { q: 'Darf ich einen ganzen Netflix-Film im Unterricht zeigen?', a: ['Ja, immer', 'Nur mit Bildungslizenz', 'Nein, nie'], correct: 1 },
                    { q: 'Muss ich ein Bild von Pixabay mit Quelle versehen?', a: ['Ja, immer', 'Nein, aber es ist nett', 'Nur bei kommerzieller Nutzung'], correct: 1 }
                ]
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let questionAnswered = false;

        function init() {
            loadQuestion();
        }

        function handleAnswer(isCorrect) {
            if (questionAnswered) return;
            questionAnswered = true;
            if (isCorrect) {
                score++;
            }
            document.getElementById('nextBtn').disabled = false;
        }

        function loadQuestion() {
            questionAnswered = false;
            const question = questions[currentQuestion];
            const container = document.getElementById('questionContainer');
            container.innerHTML = '';
            
            document.getElementById('checkBtn').style.display = 'none';
            document.getElementById('checkBtn').onclick = null;
            
            const questionFuncs = {
                'swipe': loadSwipeQuestion,
                'drag': loadDragQuestion,
                'slider': loadSliderQuestion,
                'chat': loadChatQuestion,
                'timeline': loadTimelineQuestion,
                'scenario': loadScenarioQuestion,
                'matching': loadMatchingQuestion,
                'quickfire': loadQuickfireQuestion
            };
            
            if(questionFuncs[question.type]) {
                questionFuncs[question.type](question, container);
            }
            
            updateProgress();
        }

        function loadSwipeQuestion(question, container) {
            let currentCard = 0;
            let correctSwipes = 0;
            
            container.innerHTML = `
                <div class="question-header"><div class="question-type">${question.title}</div><p>${question.intro}</p></div>
                <div class="swipe-hint"><div class="swipe-left">← Verboten</div><div class="swipe-right">Erlaubt →</div></div>
                <div class="swipe-container" id="swipeContainer">
                    ${question.cards.map((card, i) => `<div class="swipe-card" style="z-index: ${question.cards.length - i};"><h3>${card.text}</h3></div>`).join('')}
                </div>
                <div style="text-align: center; margin-top: 20px;"><span id="cardCounter">Karte 1 von ${question.cards.length}</span></div>`;
            
            const cards = Array.from(container.querySelectorAll('.swipe-card'));
            
            cards.forEach((card, index) => {
                let startX = 0, isDragging = false;
                
                const handleStart = (e) => {
                    if (index !== currentCard) return;
                    isDragging = true;
                    startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
                    card.classList.add('dragging');
                };
                
                const handleMove = (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                    const currentX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
                    const deltaX = currentX - startX;
                    card.style.transform = `translateX(${deltaX}px) rotate(${deltaX * 0.1}deg)`;
                };
                
                const handleEnd = (e) => {
                    if (!isDragging) return;
                    isDragging = false;
                    card.classList.remove('dragging');
                    const deltaX = (e.type.includes('mouse') ? e.clientX : e.changedTouches[0].clientX) - startX;
                    
                    if (Math.abs(deltaX) > 100) {
                        const swipeRight = deltaX > 0;
                        if (swipeRight === question.cards[index].correct) correctSwipes++;
                        
                        card.style.transform = `translateX(${deltaX > 0 ? 1000 : -1000}px) rotate(${deltaX > 0 ? 45 : -45}deg)`;
                        card.style.opacity = '0';
                        
                        setTimeout(() => {
                            card.style.display = 'none';
                            currentCard++;
                            
                            if (currentCard < cards.length) {
                                document.getElementById('cardCounter').textContent = `Karte ${currentCard + 1} von ${cards.length}`;
                            } else {
                                handleAnswer(correctSwipes >= cards.length / 2);
                            }
                        }, 300);
                    } else {
                        card.style.transform = '';
                    }
                };
                
                card.addEventListener('mousedown', handleStart);
                card.addEventListener('touchstart', handleStart, { passive: true });
                card.addEventListener('mousemove', handleMove);
                card.addEventListener('touchmove', handleMove, { passive: false });
                card.addEventListener('mouseup', handleEnd);
                card.addEventListener('touchend', handleEnd);
                card.addEventListener('mouseleave', handleEnd);
            });
        }

        function loadDragQuestion(question, container) {
            container.innerHTML = `
                <div class="question-header"><div class="question-type">${question.title}</div><p>${question.intro}</p></div>
                <div class="drag-container">
                    <div class="drag-items"><h4>Materialien:</h4>${question.items.map(item => `<div class="drag-item" draggable="true" data-item="${item}">${item}</div>`).join('')}</div>
                    <div class="drop-zones">${question.zones.map(zone => `<div class="drop-zone" data-zone="${zone.id}"><div class="drop-zone-title">${zone.title}</div></div>`).join('')}</div>
                </div>`;

            const dragItems = container.querySelectorAll('.drag-item');
            const dropZones = container.querySelectorAll('.drop-zone');
            const itemsContainer = container.querySelector('.drag-items');

            dragItems.forEach(item => {
                item.addEventListener('dragstart', e => e.dataTransfer.setData('text', e.target.dataset.item));
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag-over'); });
                zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
                zone.addEventListener('drop', e => {
                    e.preventDefault();
                    zone.classList.remove('drag-over');
                    const itemText = e.dataTransfer.getData('text');
                    const draggedElement = document.querySelector(`[data-item="${itemText}"]`);
                    if (draggedElement) zone.appendChild(draggedElement);
                    if (itemsContainer.children.length <= 1) document.getElementById('checkBtn').style.display = 'inline-flex';
                });
            });

            document.getElementById('checkBtn').onclick = () => {
                let correctCount = 0;
                dropZones.forEach(zone => {
                    const zoneData = question.zones.find(z => z.id === zone.dataset.zone);
                    zone.querySelectorAll('.drag-item').forEach(item => {
                        const isCorrect = zoneData.correct.includes(item.dataset.item);
                        item.style.background = isCorrect ? '#e8f5e9' : '#ffebee';
                        item.style.borderColor = isCorrect ? '#4caf50' : '#f44336';
                        if(isCorrect) correctCount++;
                    });
                });
                handleAnswer(correctCount >= question.items.length / 2);
                document.getElementById('checkBtn').style.display = 'none';
            };
        }

        function loadSliderQuestion(question, container) {
            let currentScenario = 0;
            let correctAnswers = 0;

            const renderScenario = () => {
                container.innerHTML = `
                    <div class="question-header"><div class="question-type">${question.title}</div><p>${question.intro}</p></div>
                    <div class="slider-container">
                        <div class="slider-scenario"><p>(${currentScenario + 1}/${question.scenarios.length}) ${question.scenarios[currentScenario].text}</p></div>
                        <div class="slider-wrapper">
                            <input type="range" class="slider" id="riskSlider" min="0" max="100" value="50">
                            <div class="slider-labels"><span>🟢 Sicher</span><span>🔴 Gefährlich</span></div>
                            <div class="slider-value" id="sliderValue">50</div>
                        </div>
                        <button id="submitSliderBtn" class="nav-button" style="margin: 20px auto; display: block;">Bewertung abgeben</button>
                    </div>`;

                const slider = document.getElementById('riskSlider');
                slider.addEventListener('input', e => document.getElementById('sliderValue').textContent = e.target.value);
                
                document.getElementById('submitSliderBtn').onclick = () => {
                    const value = parseInt(slider.value);
                    const scenario = question.scenarios[currentScenario];
                    if (value >= scenario.correctRange[0] && value <= scenario.correctRange[1]) correctAnswers++;
                    
                    currentScenario++;
                    if (currentScenario < question.scenarios.length) {
                        renderScenario();
                    } else {
                        container.innerHTML = `<div style="text-align:center; padding: 40px;"><h3>Alle Szenarien bewertet!</h3><p>${correctAnswers} von ${question.scenarios.length} korrekt eingeschätzt.</p></div>`;
                        handleAnswer(correctAnswers >= question.scenarios.length / 2);
                    }
                };
            };
            renderScenario();
        }

        function loadChatQuestion(question, container) {
            container.innerHTML = `
                <div class="question-header"><div class="question-type">${question.title}</div><p>${question.intro}</p></div>
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">${question.conversation.map(msg => `<div class="chat-message ${msg.from}"><div class="message-bubble">${msg.text}</div></div>`).join('')}</div>
                    <div class="chat-options">${question.options.map((option, i) => `<div class="chat-option" data-index="${i}">${option.text}</div>`).join('')}</div>
                </div>`;

            container.querySelectorAll('.chat-option').forEach(optionEl => {
                optionEl.onclick = () => {
                    if(questionAnswered) return;
                    const index = parseInt(optionEl.dataset.index);
                    const option = question.options[index];
                    const messagesDiv = document.getElementById('chatMessages');
                    
                    messagesDiv.innerHTML += `<div class="chat-message user"><div class="message-bubble">${option.text}</div></div>`;
                    
                    setTimeout(() => {
                        messagesDiv.innerHTML += `<div class="chat-message"><div class="message-bubble" style="background:${option.correct ? '#e8f5e9' : '#ffebee'};">${option.feedback}</div></div>`;
                        messagesDiv.scrollTop = messagesDiv.scrollHeight;
                        handleAnswer(option.correct);
                    }, 500);
                    
                    container.querySelector('.chat-options').style.display = 'none';
                };
            });
        }
        
        function loadTimelineQuestion(question, container) {
            container.innerHTML = `
                <div class="question-header"><div class="question-type">${question.title}</div><p>${question.intro}</p></div>
                <div class="drag-items" style="margin-bottom:20px;"><h4>Schritte:</h4><div style="display:flex; flex-wrap:wrap; gap:10px;">${question.events.map(event => `<div class="drag-item" draggable="true" data-item="${event}">${event}</div>`).join('')}</div></div>
                <div class="drop-zones" style="grid-template-columns: repeat(${question.events.length}, 1fr);">${question.events.map((_, i) => `<div class="drop-zone" data-zone-id="${i}"><div class="drop-zone-title">Schritt ${i+1}</div></div>`).join('')}</div>`;

            const dragItems = container.querySelectorAll('.drag-item');
            const dropZones = container.querySelectorAll('.drop-zone');
            const itemsContainer = container.querySelector('.drag-items > div');

            dragItems.forEach(item => {
                item.addEventListener('dragstart', e => e.dataTransfer.setData('text', e.target.dataset.item));
            });
            
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag-over'); });
                zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
                zone.addEventListener('drop', e => {
                    e.preventDefault();
                    zone.classList.remove('drag-over');
                    // Allow only one item per slot
                    if (zone.children.length > 1) {
                         itemsContainer.appendChild(zone.children[1]);
                    }
                    const itemText = e.dataTransfer.getData('text');
                    const draggedElement = document.querySelector(`[data-item="${itemText}"]`);
                    if (draggedElement) zone.appendChild(draggedElement);
                    if (itemsContainer.children.length === 0) document.getElementById('checkBtn').style.display = 'inline-flex';
                });
            });

            document.getElementById('checkBtn').onclick = () => {
                let correctCount = 0;
                dropZones.forEach((zone, index) => {
                    const item = zone.querySelector('.drag-item');
                    if(item) {
                        const isCorrect = item.dataset.item === question.correctOrder[index];
                        item.style.background = isCorrect ? '#e8f5e9' : '#ffebee';
                        item.style.borderColor = isCorrect ? '#4caf50' : '#f44336';
                        if(isCorrect) correctCount++;
                    }
                });
                handleAnswer(correctCount === question.events.length);
                document.getElementById('checkBtn').style.display = 'none';
            };
        }

        function loadScenarioQuestion(question, container) {
            let currentDecision = 0;
            
            const renderDecision = (index) => {
                const decision = question.decisions[index];
                container.innerHTML = `
                    <div class="question-header"><div class="question-type">${question.title}</div><p>${question.intro}</p></div>
                    <div style="background:#f5f5f5; padding:20px; border-radius:10px;">
                        <p><strong>Szenario:</strong> ${question.scenario}</p>
                        <div style="background:white; padding:20px; border-radius:8px; margin-top:15px;">
                            <h4>${decision.question}</h4>
                            <div class="chat-options" style="margin-top:15px;">${decision.options.map((opt, i) => `<div class="chat-option" data-opt-index="${i}">${opt.text}</div>`).join('')}</div>
                        </div>
                        <div id="scenarioFeedback" style="margin-top:15px; padding:15px; border-radius:8px; display:none;"></div>
                    </div>`;

                container.querySelectorAll('.chat-option').forEach(optEl => {
                    optEl.onclick = () => {
                        if(questionAnswered && !decision.next) return;
                        const optIndex = parseInt(optEl.dataset.index);
                        const option = decision.options[optIndex];
                        const feedbackDiv = document.getElementById('scenarioFeedback');

                        feedbackDiv.textContent = option.feedback;
                        feedbackDiv.style.display = 'block';

                        if(option.result) {
                            let isCorrect = option.result === 'success' || option.result === 'ok';
                            feedbackDiv.style.background = isCorrect ? '#e8f5e9' : '#ffebee';
                            handleAnswer(isCorrect);
                        } else if (option.next !== undefined) {
                            currentDecision = option.next;
                            setTimeout(() => renderDecision(currentDecision), 1500);
                        }
                    };
                });
            };
            renderDecision(0);
        }

        function loadMatchingQuestion(question, container) {
            const shuffledRight = [...question.pairs].map(p => p.right).sort(() => Math.random() - 0.5);
            container.innerHTML = `
                <div class="question-header"><div class="question-type">${question.title}</div><p>${question.intro}</p></div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                    <div><h4>Begriffe:</h4>${question.pairs.map((p,i) => `<div class="drag-item match-item" data-id="${i}">${p.left}</div>`).join('')}</div>
                    <div><h4>Definitionen:</h4>${shuffledRight.map(r => `<div class="drop-zone match-zone" data-text="${r}" style="min-height:60px; padding:15px;">${r}</div>`).join('')}</div>
                </div>`;
            
            let selectedItem = null;
            container.querySelectorAll('.match-item').forEach(item => {
                item.onclick = () => {
                    container.querySelectorAll('.match-item').forEach(i => i.style.border = '2px solid #ddd');
                    item.style.border = '2px solid #0050a0';
                    selectedItem = item;
                };
            });
            container.querySelectorAll('.match-zone').forEach(zone => {
                zone.onclick = () => {
                    if (selectedItem && zone.children.length === 1) {
                         const existing = zone.querySelector('.match-item');
                         if(existing) document.querySelector('div[style*="grid-template-columns"]').children[0].appendChild(existing);
                    }
                    if (selectedItem) {
                        zone.appendChild(selectedItem);
                        selectedItem.style.border = '2px solid #ddd';
                        selectedItem = null;
                    }
                    if(document.querySelector('div[style*="grid-template-columns"]').children[0].children.length === 1) { // 1 for h4
                        document.getElementById('checkBtn').style.display = 'inline-flex';
                    }
                };
            });
            
            document.getElementById('checkBtn').onclick = () => {
                let correctCount = 0;
                container.querySelectorAll('.match-zone').forEach(zone => {
                    const item = zone.querySelector('.match-item');
                    if(item){
                        const pair = question.pairs[item.dataset.id];
                        const isCorrect = pair.right === zone.dataset.text;
                        zone.style.background = isCorrect ? '#e8f5e9' : '#ffebee';
                        if(isCorrect) correctCount++;
                    }
                });
                handleAnswer(correctCount >= question.pairs.length / 2);
                document.getElementById('checkBtn').style.display = 'none';
            };
        }

        function loadQuickfireQuestion(question, container) {
            let currentQ = 0, quickfireScore = 0, timer;
            
            const renderQ = () => {
                clearInterval(timer);
                let timeLeft = 10;
                const q = question.questions[currentQ];
                container.innerHTML = `
                    <div class="question-header"><div class="question-type">${question.title}</div><p>${question.intro}</p></div>
                    <div style="text-align:center;">
                        <div id="timer" style="font-size:48px; color:#0050a0;">${timeLeft}</div>
                        <h3 style="margin:20px 0; font-size:22px;">${q.q}</h3>
                        <div class="chat-options">${q.a.map((ans, i) => `<div class="chat-option" data-index="${i}">${ans}</div>`).join('')}</div>
                    </div>`;

                timer = setInterval(() => {
                    timeLeft--;
                    document.getElementById('timer').textContent = timeLeft;
                    document.getElementById('timer').style.color = timeLeft <= 3 ? '#f44336' : '#0050a0';
                    if (timeLeft <= 0) nextQ(null);
                }, 1000);

                container.querySelectorAll('.chat-option').forEach(opt => {
                    opt.onclick = () => nextQ(parseInt(opt.dataset.index));
                });
            };

            const nextQ = (answerIndex) => {
                clearInterval(timer);
                const q = question.questions[currentQ];
                if(answerIndex === q.correct) quickfireScore++;
                
                currentQ++;
                if (currentQ < question.questions.length) {
                    renderQ();
                } else {
                    container.innerHTML = `<div style="text-align:center; padding: 40px;"><h3>Quickfire beendet!</h3><p>${quickfireScore} von ${question.questions.length} richtig.</p></div>`;
                    handleAnswer(quickfireScore >= question.questions.length / 2);
                }
            };
            renderQ();
        }

        function nextQuestion() {
            currentQuestion++;
            if (currentQuestion < questions.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        function updateProgress() {
            const progress = (currentQuestion / questions.length) * 100;
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.querySelector('span').textContent = `${currentQuestion + 1} / ${questions.length}`;
            document.getElementById('currentScore').textContent = score;
            document.getElementById('nextBtn').disabled = true;
        }

        function showResults() {
            const maxScore = questions.length;
            const percentage = Math.round((score / maxScore) * 100);
            
            // Ergebnis im localStorage speichern
            localStorage.setItem('quiz_praxis_progress', percentage);

            const container = document.querySelector('.quiz-card');
            container.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <h2 style="color: #0050a0; font-size: 36px;">Quiz abgeschlossen! 🎉</h2>
                    <div class="score-number">${score} / ${maxScore}</div>
                    <p style="font-size: 24px; margin: 20px 0;">${percentage}% richtig</p>
                    <p style="font-size: 18px; color: #666;">
                        ${percentage >= 80 ? 'Hervorragend! Du bist ein Urheberrechts-Profi! 🏆' :
                          percentage >= 50 ? 'Gut gemacht! Du kennst dich schon gut aus! 🎯' :
                          'Schau dir nochmal die Lernmaterialien an! 📚'}
                    </p>
                    <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px;">
                        <button class="nav-button" onclick="location.reload()">Wiederholen</button>
                        <a href="../index.html" class="nav-button">Zur Übersicht</a>
                    </div>
                </div>`;
        }

        window.onload = init;
    </script>
</body>
</html>
